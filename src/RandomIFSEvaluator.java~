import java.io.*;
import java.util.Vector;
import java.awt.image.*;
import javax.imageio.*;
import java.awt.Color;

public class RandomIFSEvaluator extends IFSEvaluator {
    IFS ifs;
    int numPoints;
    int iterations; 
    RandomIFSEvaluator(IFS ifs, int numPoints, int iterations) {
        assert numPoints > 0 : "numPoints must be positive";
        assert iterations > 0 : "iterations must be positive";
        this.ifs = ifs;
        this.iterations = iterations;
        this.numPoints = numPoints;
    }

    public void run(int width, int height) {
        Color c = new Color(255,255,255);
        int rgb = c.getRGB();
        BufferedImage img = new BufferedImage(width, height,
                                              BufferedImage.TYPE_INT_RGB);
        for(int point=0; point < this.numPoints; point++) {
            Coordinate p = new Coordinate();
            for(int iteration=0; iteration < this.iterations; iteration++) {
                Transform t = this.ifs.chooseTransform();
                p = t.transform(p);
                if (iteration > 25) {
                    Coordinate pix = p.scale(width, height).integerize();
                    img.setRGB((int)pix.getX(), (int)pix.getY(), rgb);
                }
            }
            try {
                File outputfile = new File("image.jpg");
                ImageIO.write(img, "jpg", outputfile);
            }
            catch(Exception e) {
                e.printStackTrace();
            }
        }        
    }
    public static void main(String[] args) {
        System.out.println("Test of random ifs evaluator");
        TwoDMatrix shrink = new TwoDMatrix(0.5, 0.0, 0.0, 0.5);
        AffineTransform t1 = new AffineTransform(shrink, new Coordinate(0.0,0.0));
        AffineTransform t2 = new AffineTransform(shrink, new Coordinate(0.5,0.0));
        AffineTransform t3 = new AffineTransform(shrink, new Coordinate(0.0,0.5));
        Vector<Transform> transforms = new Vector<Transform>();
        transforms.add(t1);
        transforms.add(t2);
        transforms.add(t3);
        IFS system = new IFS(transforms);
        RandomIFSEvaluator ifsRunner = new RandomIFSEvaluator(system, 1000, 100);
        ifsRunner.run(1000,1000);
    }
    
}
